<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>PALOMA App Server</title>

    <link rel="stylesheet" href="/index.css"/>
    <script defer src="/index.js"></script>
</head>

<body>
<h1>PALOMA Test API Server</h1>
<p>
    My app API test platform is described below. Some APIs require a request body to be sent (like
    <code>/auth/login</code> and <code>/auth/register</code>), while others require an Authorization authToken
    (received at login). To view the required JSON format, click on a command below and look at the example request
    body. To try out an API, modify the request as needed, and press Send.
</p>

<h2>HTTP Endpoints</h2>
<table>
    <tr>
        <td class="endpoint" onclick="register()">
            <div class="method">[POST]</div>
            <div class="path">/auth/register</div>
        </td>
        <td>
            <span class="description">Register a user</span> Creates a new user account. Returns user data on success.
            No authorization token required.
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="login()">
            <div class="method">[POST]</div>
            <div class="path">/auth/login</div>
        </td>
        <td>
            <span class="description">Log in a user</span> Authenticates user and returns JWT access and refresh tokens.
            No authorization token required.
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="logout()">
            <div class="method">[DELETE]</div>
            <div class="path">/insession/logout</div>
        </td>
        <td>
            <span class="description">Logs out an authenticated user</span> Revokes all refresh tokens for the user.
            An authorization token is required. No request body is needed as the system uses the access token 
            to identify the user and revoke all their refresh tokens.
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="refresh()">
            <div class="method">[POST]</div>
            <div class="path">/insession/refresh</div>
        </td>
        <td>
            <span class="description">Refresh access token</span> Uses refresh token to generate a new access token.
            An authorization token is required. Requires valid refresh token in request body.
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="dailyCheckIn()">
            <div class="method">[POST]</div>
            <div class="path">/loggedIn</div>
        </td>
        <td>
            <span class="description">Prompts the user to fill out their daily check-in</span>
            An authToken is required
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="getScore()">
            <div class="method">[GET]</div>
            <div class="path">/loggedIn</div>
        </td>
        <td>
            <span class="description">Gets the cumulative score</span>
            An authToken is required
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="addMedication()">
            <div class="method">[POST]</div>
            <div class="path">/loggedIn</div>
        </td>
        <td>
            <span class="description">Prompts to add medications they take</span>
            An authToken is required
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="updateMedication()">
            <div class="method">[PUT]</div>
            <div class="path">/loggedIn</div>
        </td>
        <td>
            <span class="description">Updates medications if they change</span>
            An authToken is required
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="getMedications()">
            <div class="method">[GET]</div>
            <div class="path">/loggedIn</div>
        </td>
        <td>
            <span class="description">gets all the medications for the user</span>
            An authToken is required
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="medications()">
            <div class="method">[POST]</div>
            <div class="path">/loggedIn</div>
        </td>
        <td>
            <span class="description">Prompts the user to fill out their daily check-in</span>
            An authToken is required
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="addContact()">
            <div class="method">[POST]</div>
            <div class="path">/loggedIn</div>
        </td>
        <td>
            <span class="description">User adds a trusted contact to their profile</span>
            An authToken is required
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="updateContact()">
            <div class="method">[PUT]</div>
            <div class="path">/loggedIn</div>
        </td>
        <td>
            <span class="description">Updates contact info</span>
            An authToken is required
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="getContacts()">
            <div class="method">[GET]</div>
            <div class="path">/loggedIn</div>
        </td>
        <td>
            <span class="description">Updates contact info</span>
            An authToken is required
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="clearAll()">
            <div class="method">[DELETE]</div>
            <div class="path">/db</div>
        </td>
        <td>
            <span class="description">Clear ALL data from the database</span> No
            authorization authToken is required.
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="makeTrustedContact()">
            <div class="method">[POST]</div>
            <div class="path">/api/roles/make-trusted-contact/{userId}</div>
        </td>
        <td>
            <span class="description">Make user a trusted contact</span> Adds TRUSTED_CONTACT role to an existing user.
            User will have both USER and TRUSTED_CONTACT roles.
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="getUserRoles()">
            <div class="method">[GET]</div>
            <div class="path">/api/roles/user/{userId}</div>
        </td>
        <td>
            <span class="description">Get user roles</span> Returns all roles assigned to a user and their primary role.
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="checkBothRoles()">
            <div class="method">[GET]</div>
            <div class="path">/api/roles/check/{userId}/has-both-roles</div>
        </td>
        <td>
            <span class="description">Check if user has both roles</span> Returns true if user has both USER and TRUSTED_CONTACT roles.
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="addRole()">
            <div class="method">[POST]</div>
            <div class="path">/api/roles/add</div>
        </td>
        <td>
            <span class="description">Add role to user</span> Adds a specific role to an existing user. Can specify if it should be primary.
        </td>
    </tr>
    <tr>
        <td class="endpoint" onclick="removeRole()">
            <div class="method">[DELETE]</div>
            <div class="path">/api/roles/remove/{userId}/{roleType}</div>
        </td>
        <td>
            <span class="description">Remove role from user</span> Removes a specific role from a user. Cannot remove the last role.
        </td>
    </tr>
</table>

<h2>Execute HTTP Request</h2>
<div class="box">
    <h3>Request</h3>
    <div class="input">
        <label for="method">Method:</label> <input type="text" id="method"/>
    </div>

    <div class="input">
        <label for="handleBox">Endpoint:</label> <input type="text" id="handleBox" name="handleBox"/>
    </div>

    <div class="input">
        <label for="authToken">Auth Token:</label> <input type="text" id="authToken" name="authToken"/>
    </div>

    <div class="input">
        <label for="requestBox">Request Body:</label> <textarea id="requestBox" name="requestBox"></textarea>
    </div>

    <button onclick="submit()">Send</button>
</div>
<div id="responseBox" class="box">
    <h3>HTTP Response</h3>
    <pre id="response" readonly></pre>
</div>
</body>
</html>
